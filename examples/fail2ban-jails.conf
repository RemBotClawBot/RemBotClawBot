# fail2ban-jails.conf
# Custom Fail2Ban jail configurations for RemBotClawBot infrastructure
# Place this file in /etc/fail2ban/jail.d/

[DEFAULT]
# Global defaults
bantime = 3600
findtime = 600
maxretry = 5
destemail = root@localhost
sender = root@localhost
mta = sendmail
action = %(action_mwl)s

[sshd]
# SSH jail
enabled = true
port = ssh
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 86400

[sshd-ddos]
# SSH DDOS protection
enabled = true
port = ssh
filter = sshd-ddos
logpath = /var/log/auth.log
maxretry = 10
findtime = 300
bantime = 600

[nginx-http-auth]
# Nginx HTTP authentication failures
enabled = true
filter = nginx-http-auth
port = http,https
logpath = /var/log/nginx/error.log
maxretry = 3
bantime = 3600

[nginx-botsearch]
# Bad bot detection
enabled = true
filter = nginx-botsearch
port = http,https
logpath = /var/log/nginx/access.log
maxretry = 2
bantime = 86400
findtime = 300

[nginx-bad-request]
# Bad requests (404, 400 errors)
enabled = true
filter = nginx-bad-request
port = http,https
logpath = /var/log/nginx/access.log
maxretry = 10
bantime = 3600
findtime = 300

[nginx-limit-req]
# Rate limiting violations
enabled = true
filter = nginx-limit-req
port = http,https
logpath = /var/log/nginx/error.log
maxretry = 5
bantime = 1800

[forgejo]
# Forgejo/Gitea brute force protection
enabled = true
port = 3000,3001
filter = forgejo
logpath = /var/log/forgejo/forgejo.log
maxretry = 5
bantime = 7200

[openclaw-api]
# OpenClaw API brute force protection
enabled = true
port = 3000
filter = openclaw-api
logpath = /var/log/openclaw/openclaw.log
maxretry = 10
bantime = 3600

[postfix]
# Postfix SMTP authentication
enabled = true
port = smtp,ssmtp,submission
filter = postfix
logpath = /var/log/mail.log
maxretry = 3
bantime = 3600

[recidive]
# Recidive (repeat offenders) jail
enabled = true
filter = recidive
logpath = /var/log/fail2ban.log
action = iptables-allports[name=recidive]
           sendmail-whois-lines[name=recidive, logpath=/var/log/fail2ban.log]
bantime = 604800  # 1 week
findtime = 86400  # 1 day
maxretry = 5

[ufw]
# UFW integration
enabled = true
filter = ufw
action = ufw[name=UFW]
logpath = /var/log/ufw.log
maxretry = 5
bantime = 3600
findtime = 600

# Custom filters
[nginx-botsearch]
filter = nginx-botsearch
failregex = ^<HOST>.*"(GET|POST|HEAD).*".*".*(Bot|bot|Crawler|Spider|scanner|scan|python|curl|wget|HTTrack|masscan|nikto|sqlmap).*"$
ignoreregex =

[nginx-bad-request]
filter = nginx-bad-request
failregex = ^<HOST>.*"(GET|POST|HEAD).*"(400|404|410|444).*
ignoreregex =

[nginx-limit-req]
filter = nginx-limit-req
failregex = ^.*limiting requests.*client: <HOST>
ignoreregex =

[forgejo]
filter = forgejo
failregex = ^.*Failed authentication attempt for.*from <HOST>
            ^.*Invalid OAuth2 token.*from <HOST>
ignoreregex =

[openclaw-api]
filter = openclaw-api
failregex = ^.*Invalid API key.*from <HOST>
            ^.*Unauthorized access attempt.*from <HOST>
ignoreregex =

# Actions
[action_mwl]
action = iptables-multiport[name=%(__name__)s, port="%(port)s", protocol="tcp", chain="INPUT"]
         mail-whois-lines[name=%(__name__)s, dest="%(destemail)s", logpath="%(logpath)s", chain="INPUT"]

# Email templates (optional - uncomment to customize)
#[DEFAULT]
#destemail = your-email@example.com
#sender = fail2ban@your-domain.com
#sendername = Fail2Ban
#mta = sendmail